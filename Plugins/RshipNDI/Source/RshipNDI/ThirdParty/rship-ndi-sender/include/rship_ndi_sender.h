#ifndef RSHIP_NDI_SENDER_H
#define RSHIP_NDI_SENDER_H

/* AUTO-GENERATED by cbindgen. DO NOT EDIT. */

#include <cstdint>

/// Opaque handle for C++ (the actual sender state)
struct RshipNDISender;

/// Configuration for NDI sender
struct RshipNDIConfig {
    /// Stream name visible on network (null-terminated UTF-8)
    const char *stream_name;
    /// Frame width in pixels
    int width;
    /// Frame height in pixels
    int height;
    /// Target framerate numerator (e.g., 60 for 60fps)
    int framerate_num;
    /// Target framerate denominator (e.g., 1 for 60fps)
    int framerate_den;
    /// Enable alpha channel (RGBA vs RGBX)
    bool enable_alpha;
    /// Number of frame buffer slots (2-4, default 3)
    int buffer_count;
};

/// Frame data passed from C++ (Unreal Engine)
struct RshipNDIFrame {
    /// Pointer to RGBA pixel data (must remain valid during call)
    const uint8_t *data;
    /// Size of data in bytes (width * height * 4 for RGBA)
    uintptr_t data_size;
    /// Frame width in pixels
    int width;
    /// Frame height in pixels
    int height;
    /// Frame number for ordering/debugging
    int64_t frame_number;
    /// Timestamp in 100-nanosecond units (NDI timecode format)
    int64_t timestamp_100ns;
};

/// Statistics returned to C++
struct RshipNDIStats {
    /// Total frames successfully sent
    uint64_t frames_sent;
    /// Frames dropped due to queue full
    uint64_t frames_dropped;
    /// Average time to send a frame in microseconds
    double avg_send_time_us;
    /// Number of connected NDI receivers
    int32_t connected_receivers;
    /// Whether the sender is healthy and running
    bool is_healthy;
    /// Current queue depth (frames waiting to send)
    int32_t queue_depth;
};

extern "C" {

/// Create a new NDI sender.
///
/// # Arguments
/// * `config` - Pointer to configuration struct
///
/// # Returns
/// * Opaque pointer to sender, or null on failure
///
/// # Safety
/// The config pointer must be valid and the stream_name must be a valid
/// null-terminated UTF-8 string.
RshipNDISender *rship_ndi_create(const RshipNDIConfig *config);

/// Destroy an NDI sender and release all resources.
///
/// # Safety
/// The sender pointer must be valid and obtained from `rship_ndi_create`.
/// After this call, the pointer is invalid and must not be used.
void rship_ndi_destroy(RshipNDISender *sender);

/// Submit a frame for NDI transmission.
///
/// This function is non-blocking. If the internal queue is full,
/// the frame is dropped and the function returns false.
///
/// # Arguments
/// * `sender` - Sender handle from `rship_ndi_create`
/// * `frame` - Pointer to frame data struct
///
/// # Returns
/// * `true` if frame was accepted for transmission
/// * `false` if frame was dropped (queue full) or error
///
/// # Safety
/// Both pointers must be valid. The frame data must remain valid for the
/// duration of this call (it is copied internally).
bool rship_ndi_submit_frame(RshipNDISender *sender,
                            const RshipNDIFrame *frame);

/// Get current statistics from the sender.
///
/// # Safety
/// Both pointers must be valid.
void rship_ndi_get_stats(const RshipNDISender *sender,
                         RshipNDIStats *stats);

/// Check if the NDI library is available on this system.
///
/// # Returns
/// * `true` if NDI runtime is installed and accessible
/// * `false` otherwise
bool rship_ndi_is_available();

} // extern "C"

#endif // RSHIP_NDI_SENDER_H
